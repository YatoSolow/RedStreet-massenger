<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RedStreet Messenger</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
        }

        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        .login-screen {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .tagline {
            color: #a0a0c0;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0d0;
            font-size: 14px;
            font-weight: 500;
        }

        .username-input {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            overflow: hidden;
        }

        .username-prefix {
            padding: 0 15px;
            background: rgba(255, 255, 255, 0.1);
            color: #ff416c;
            font-weight: 600;
            font-size: 14px;
            height: 50px;
            display: flex;
            align-items: center;
        }

        input, textarea {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        input:focus, textarea:focus {
            background: rgba(255, 255, 255, 0.05);
        }

        .error-message {
            color: #ff6b6b;
            font-size: 13px;
            margin-top: 8px;
            min-height: 20px;
        }

        .success-message {
            color: #4cd964;
            font-size: 13px;
            margin-top: 8px;
        }

        button {
            padding: 16px;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 65, 108, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .hint {
            font-size: 12px;
            color: #8080a0;
            margin-top: 15px;
        }

        /* –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ */
        .chat-screen {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .header {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 22px;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .nav-btn.active {
            background: rgba(255, 65, 108, 0.2);
            border-color: rgba(255, 65, 108, 0.4);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            font-size: 14px;
            color: #b0b0d0;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ff6b6b;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.2);
        }

        .main-content {
            display: flex;
            height: calc(90vh - 70px);
        }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.03);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .section-title {
            color: #a0a0c0;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        /* –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .search-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            min-width: 60px;
        }

        .search-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ */
        .chats-list {
            margin-top: 10px;
        }

        .chat-item {
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            border-radius: 10px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .chat-item.active {
            background: rgba(255, 65, 108, 0.1);
            border-left: 3px solid #ff416c;
        }

        .chat-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-last-message {
            color: #a0a0c0;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .chat-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.03);
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-title-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .chat-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-action-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 75%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .message.my {
            align-self: flex-end;
        }

        .message.bot {
            align-self: flex-start;
        }

        .message-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 18px;
            border-radius: 18px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .message.my .message-content {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            border-bottom-right-radius: 5px;
        }

        .message.bot .message-content {
            background: rgba(32, 201, 151, 0.2);
            border: 1px solid rgba(32, 201, 151, 0.3);
            border-bottom-left-radius: 5px;
        }

        .message.system .message-content {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
            text-align: center;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .message-username {
            font-weight: 600;
            color: #ff416c;
        }

        .message.bot .message-username {
            color: #20c997;
        }

        .message.system .message-username {
            color: #ffc107;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-left: auto;
        }

        .message-text {
            line-height: 1.5;
            word-break: break-word;
        }

        /* –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .voice-message {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .voice-play-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s;
        }

        .voice-play-btn:hover {
            transform: scale(1.1);
        }

        .voice-play-btn.playing {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }

        .voice-progress {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .voice-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.1s linear;
        }

        .voice-duration {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            min-width: 40px;
            text-align: right;
        }

        .voice-record-btn {
            background: rgba(255, 65, 108, 0.2);
            border: 1px solid rgba(255, 65, 108, 0.4);
        }

        .voice-record-btn.recording {
            background: #ff416c;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 65, 108, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 65, 108, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 65, 108, 0); }
        }

        /* –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ - –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–î–ï–õ–ê–ù–ê */
        .input-area {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 15px;
            align-items: flex-end;
            background: rgba(255, 255, 255, 0.03);
        }

        .input-tools {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .input-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 0;
        }

        #messageInput {
            width: 100%;
            min-height: 60px;
            max-height: 150px;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            color: white;
            font-size: 16px;
            line-height: 1.5;
            resize: none;
            outline: none;
            font-family: inherit;
            transition: all 0.3s;
        }

        #messageInput:focus {
            border-color: rgba(255, 65, 108, 0.6);
            box-shadow: 0 0 0 4px rgba(255, 65, 108, 0.15);
            background: rgba(255, 255, 255, 0.1);
        }

        .input-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .action-btn.recording {
            background: #ff416c;
            animation: pulse 1.5s infinite;
        }

        .send-btn-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
            margin-left: auto;
        }

        .send-btn-circle:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 65, 108, 0.3);
        }

        .send-btn-circle:active {
            transform: translateY(0) scale(1);
        }

        /* –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .found-users {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .found-user {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .found-user:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-screen {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            width: 100%;
            max-width: 500px;
            height: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .profile-content {
            padding: 40px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            cursor: pointer;
        }

        .profile-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-change {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .profile-username {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-email {
            color: #a0a0c0;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0d0;
            font-size: 14px;
            font-weight: 500;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus {
            border-color: rgba(255, 65, 108, 0.5);
            background: rgba(255, 255, 255, 0.1);
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .profile-actions button {
            flex: 1;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            animation: fadeIn 0.3s ease;
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* –ê–≤–∞—Ç–∞—Ä–∫–∏ */
        .avatars-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .avatar-option {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .avatar-option:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .avatar-option.selected {
            border-color: #ff416c;
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(255, 65, 108, 0.3);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }
            
            .chat-info, .section-title, .search-box, .chat-last-message, .nav-buttons span {
                display: none;
            }
            
            .chat-item {
                justify-content: center;
                padding: 15px 10px;
            }
            
            .header-left h1 {
                font-size: 18px;
            }
            
            .input-area {
                padding: 15px;
            }
            
            .profile-content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div class="login-screen" id="loginScreen">
        <div class="logo">RedStreet</div>
        <div class="tagline">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Å –∏–≥—Ä–∞–º–∏ –∏ –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</div>
        
        <div class="input-group">
            <label class="input-label">–°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —é–∑–µ—Ä–Ω–µ–π–º</label>
            <div class="username-input">
                <div class="username-prefix">@</div>
                <input type="text" 
                       id="usernameInput" 
                       placeholder="username"
                       maxlength="20"
                       autocomplete="off"
                       oninput="validateUsername(this.value)">
            </div>
            <div class="error-message" id="usernameError"></div>
        </div>
        
        <div class="hint">
            –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã. –ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–∑–∂–µ.
        </div>
        
        <button onclick="login()" id="loginBtn" disabled>–í–æ–π—Ç–∏ –≤ RedStreet</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
    <div class="chat-screen" id="chatScreen">
        <div class="header">
            <div class="header-left">
                <h1>RedStreet Messenger</h1>
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showChat()">
                        üí¨ –ß–∞—Ç—ã
                    </button>
                    <button class="nav-btn" onclick="showProfile()">
                        üë§ –ü—Ä–æ—Ñ–∏–ª—å
                    </button>
                </div>
            </div>
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar" onclick="showProfile()" title="–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
                    <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                <div class="user-info">
                    <div id="currentUsername"></div>
                    <div style="font-size: 12px; color: #8080a0;">Online</div>
                </div>
                <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- –°–∞–π–¥–±–∞—Ä -->
            <div class="sidebar">
                <div class="sidebar-content">
                    <div class="sidebar-section">
                        <div class="section-title">–ü–æ–∏—Å–∫ –¥—Ä—É–∑–µ–π –∏ –±–æ—Ç–æ–≤</div>
                        <div class="search-box">
                            <input type="text" 
                                   id="searchUserInput" 
                                   class="search-input" 
                                   placeholder="–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
                                   onkeypress="handleSearchKeyPress(event)">
                            <button class="search-btn" onclick="searchUser()">–ü–æ–∏—Å–∫</button>
                        </div>
                        <div class="found-users" id="foundUsers"></div>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="section-title">–í–∞—à–∏ —á–∞—Ç—ã</div>
                        <div class="chats-list" id="chatsList">
                            <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
            <div class="chat-area" id="chatArea">
                <div class="chat-header">
                    <div class="chat-title" id="currentChatTitle">
                        <div class="chat-title-avatar">G</div>
                        <span>–û–±—â–∏–π —á–∞—Ç</span>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn" onclick="startGameWithBot()" id="gameBotBtn">
                            üéÆ –ò–≥—Ä–∞—Ç—å —Å –ì–æ—Ä–æ–¥–∫–æ–º
                        </button>
                        <button class="chat-action-btn" onclick="showAddUserModal()">
                            <span>+</span> –î–æ–±–∞–≤–∏—Ç—å –≤ —á–∞—Ç
                        </button>
                    </div>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    <div class="message system">
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-username">–°–∏—Å—Ç–µ–º–∞</span>
                            </div>
                            <div class="message-text">
                                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ RedStreet!<br>
                                ‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ "—Å—Ç–∞—Ä—Ç" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –≤ –≥–æ—Ä–æ–¥–∞<br>
                                ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É üé§ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π<br>
                                ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="input-area">
                    <div class="input-tools">
                        <button class="action-btn voice-record-btn" id="voiceRecordBtn" onclick="toggleVoiceRecording()" title="–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ">
                            üé§
                        </button>
                        <button class="action-btn" onclick="showEmojiPicker()" title="–î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏">
                            üòä
                        </button>
                    </div>
                    
                    <div class="input-main">
                        <textarea 
                            id="messageInput" 
                            placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ '—Å—Ç–∞—Ä—Ç' –¥–ª—è –∏–≥—Ä—ã..."
                            oninput="autoResize(this)"
                            onkeypress="handleMessageKeyPress(event)"></textarea>
                        
                        <div class="input-actions">
                            <div class="action-buttons">
                                <button class="action-btn" onclick="attachFile()" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">
                                    üìé
                                </button>
                                <button class="action-btn" onclick="showCitiesHelp()" title="–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã">
                                    üéØ
                                </button>
                            </div>
                            
                            <button class="send-btn-circle" onclick="sendMessage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                                ‚û§
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="chat-area" id="profileArea" style="display: none;">
                <div class="chat-header">
                    <div class="chat-title">
                        <div class="chat-title-avatar">üë§</div>
                        <span>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</span>
                    </div>
                    <button class="chat-action-btn" onclick="showChat()">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ —á–∞—Ç–∞–º
                    </button>
                </div>
                
                <div class="messages-container" style="background: transparent; padding: 30px;">
                    <div class="profile-screen" id="profileScreen">
                        <div class="profile-content">
                            <div class="profile-header">
                                <div class="profile-avatar-container" onclick="openAvatarSelector()">
                                    <div class="profile-avatar" id="profileAvatar">
                                        <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                                    </div>
                                    <div class="avatar-change">‚úèÔ∏è</div>
                                </div>
                                <div class="profile-username" id="profileUsername"></div>
                                <div class="profile-email" id="profileEmail"></div>
                            </div>
                            
                            <form class="profile-form" onsubmit="updateProfile(event)">
                                <div class="form-group">
                                    <label class="form-label">–ò–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                                    <input type="text" 
                                           id="profileDisplayName" 
                                           class="form-input" 
                                           placeholder="–ö–∞–∫ –≤–∞—Å –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏–µ">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–û —Å–µ–±–µ</label>
                                    <textarea 
                                        id="profileBio" 
                                        class="form-textarea" 
                                        placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                    <input type="text" 
                                           id="profileStatus" 
                                           class="form-input" 
                                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Online, –í –ø—É—Ç–∏, –ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å">
                                </div>
                                
                                <div class="profile-actions">
                                    <button type="button" class="modal-btn secondary" onclick="showChat()">
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                    <button type="submit" class="modal-btn primary">
                                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="modal-overlay" id="addUserModal">
        <div class="modal">
            <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤ —á–∞—Ç</div>
            <input type="text" 
                   id="addUserInput" 
                   class="search-input" 
                   placeholder="@username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                   style="width: 100%; margin-bottom: 15px;">
            <div class="error-message" id="addUserError"></div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="hideAddUserModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" onclick="addUserToChat()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
    <div class="modal-overlay" id="avatarModal">
        <div class="modal">
            <div class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É</div>
            <div class="avatars-grid" id="avatarsGrid">
                <!-- –ê–≤–∞—Ç–∞—Ä–∫–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeAvatarSelector()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" onclick="saveSelectedAvatar()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <input type="file" id="fileInput" style="display: none;" accept="image/*,audio/*">

    <script>
        // ============ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============
        let currentUser = '';
        let usersDatabase = {};
        let messages = [];
        let currentChat = 'general';
        let chats = [
            { id: 'general', name: '–û–±—â–∏–π —á–∞—Ç', type: 'group', users: [] },
            { id: 'bot_games', name: 'üéÆ –ò–≥—Ä—ã —Å –±–æ—Ç–∞–º–∏', type: 'bot', users: [] }
        ];
        let currentProfile = {};
        let citiesGameActive = false;
        let lastCity = '';
        let usedCities = new Set();
        let voiceRecorder = null;
        let isRecording = false;
        let audioChunks = [];
        let currentAudio = null;
        let selectedAvatar = 'default';

        // –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏
        const citiesList = [
            '–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å',
            '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', '–ß–µ–ª—è–±–∏–Ω—Å–∫', '–°–∞–º–∞—Ä–∞', '–û–º—Å–∫', '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É',
            '–£—Ñ–∞', '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '–ü–µ—Ä–º—å', '–í–æ—Ä–æ–Ω–µ–∂', '–í–æ–ª–≥–æ–≥—Ä–∞–¥',
            '–ê–±–∞–∫–∞–Ω', '–ê–Ω–∞–ø–∞', '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫', '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å', '–ë–∞–ª–∞—à–∏—Ö–∞',
            '–ë–∞—Ä–Ω–∞—É–ª', '–ë–µ–ª–≥–æ—Ä–æ–¥', '–ë—Ä—è–Ω—Å–∫', '–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫', '–í–ª–∞–¥–∏–∫–∞–≤–∫–∞–∑',
            '–í–ª–∞–¥–∏–º–∏—Ä', '–í–æ–ª–æ–≥–¥–∞', '–í–æ–ª–∂—Å–∫–∏–π', '–ì—Ä–æ–∑–Ω—ã–π', '–î–∑–µ—Ä–∂–∏–Ω—Å–∫',
            '–î—É–±–Ω–∞', '–ï–ª–µ—Ü', '–ñ–µ–ª–µ–∑–Ω–æ–≥–æ—Ä—Å–∫', '–ó–ª–∞—Ç–æ—É—Å—Ç', '–ò–≤–∞–Ω–æ–≤–æ',
            '–ò–∂–µ–≤—Å–∫', '–ò—Ä–∫—É—Ç—Å–∫', '–ô–æ—à–∫–∞—Ä-–û–ª–∞', '–ö–∞–ª—É–≥–∞', '–ö–µ–º–µ—Ä–æ–≤–æ',
            '–ö–∏—Ä–æ–≤', '–ö–æ—Å—Ç—Ä–æ–º–∞', '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä', '–ö—É—Ä–≥–∞–Ω', '–ö—É—Ä—Å–∫',
            '–ö—ã–∑—ã–ª', '–õ–∏–ø–µ—Ü–∫', '–ú–∞–≥–∞–¥–∞–Ω', '–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫', '–ú–∞–π–∫–æ–ø',
            '–ú–∞—Ö–∞—á–∫–∞–ª–∞', '–ú–∏–∞—Å—Å', '–ú—É—Ä–º–∞–Ω—Å–∫', '–ú—É—Ä–æ–º', '–ú—ã—Ç–∏—â–∏',
            '–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã', '–ù–∞–ª—å—á–∏–∫', '–ù–∞—Ä—å—è–Ω-–ú–∞—Ä', '–ù–∞–∑—Ä–∞–Ω—å', '–ù–æ—Ä–∏–ª—å—Å–∫',
            '–ù–æ–≤—ã–π –£—Ä–µ–Ω–≥–æ–π', '–û—Ä—ë–ª', '–û—Ä–µ–Ω–±—É—Ä–≥', '–ü–µ–Ω–∑–∞', '–ü–µ—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫',
            '–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π', '–ü–æ–¥–æ–ª—å—Å–∫', '–ü—Å–∫–æ–≤', '–†—è–∑–∞–Ω—å', '–°–∞–ª–µ—Ö–∞—Ä–¥',
            '–°–∞—Ä–∞–Ω—Å–∫', '–°–∞—Ä–∞—Ç–æ–≤', '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å', '–°–µ–≤–µ—Ä–æ–¥–≤–∏–Ω—Å–∫', '–°–º–æ–ª–µ–Ω—Å–∫',
            '–°–æ—á–∏', '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å', '–°—Ç–µ—Ä–ª–∏—Ç–∞–º–∞–∫', '–°—É—Ä–≥—É—Ç', '–°—ã–∫—Ç—ã–≤–∫–∞—Ä',
            '–¢–∞–≥–∞–Ω—Ä–æ–≥', '–¢–∞–º–±–æ–≤', '–¢–≤–µ—Ä—å', '–¢–æ–ª—å—è—Ç—Ç–∏', '–¢–æ–º—Å–∫',
            '–¢—É–ª–∞', '–¢—é–º–µ–Ω—å', '–£–ª–∞–Ω-–£–¥—ç', '–£–ª—å—è–Ω–æ–≤—Å–∫', '–£—Å—Å—É—Ä–∏–π—Å–∫',
            '–£—Ö—Ç–∞', '–•–∞–±–∞—Ä–æ–≤—Å–∫', '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫', '–ß–µ–±–æ–∫—Å–∞—Ä—ã', '–ß–µ—Ä–µ–ø–æ–≤–µ—Ü',
            '–ß–µ—Ä–∫–µ—Å—Å–∫', '–ß–∏—Ç–∞', '–≠–ª–∏—Å—Ç–∞', '–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫', '–Ø–∫—É—Ç—Å–∫',
            '–Ø—Ä–æ—Å–ª–∞–≤–ª—å'
        ];

        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        window.onload = function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const savedUser = localStorage.getItem('redstreet_current_user');
            
            if (savedUser) {
                const savedUsers = JSON.parse(localStorage.getItem('redstreet_users') || '{}');
                if (savedUsers[savedUser]) {
                    currentUser = savedUser;
                    currentProfile = JSON.parse(localStorage.getItem(`redstreet_profile_${currentUser}`) || '{}');
                    
                    loadChats();
                    loadMessages();
                    
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('chatScreen').style.display = 'block';
                    updateUserInfo();
                    document.getElementById('messageInput').focus();
                    return;
                }
            }
            
            document.getElementById('usernameInput').focus();
        };

        // ============ –í–ê–õ–ò–î–ê–¶–ò–Ø –Æ–ó–ï–†–ù–ï–ô–ú–ê ============
        function validateUsername(username) {
            const errorElement = document.getElementById('usernameError');
            const loginBtn = document.getElementById('loginBtn');
            
            errorElement.textContent = '';
            loginBtn.disabled = true;
            
            if (!username) return false;
            
            const validRegex = /^[a-zA-Z0-9_]+$/;
            if (!validRegex.test(username)) {
                errorElement.textContent = '–¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                return false;
            }
            
            if (username.length < 3) {
                errorElement.textContent = '–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                return false;
            }
            
            if (username.length > 20) {
                errorElement.textContent = '–ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤';
                return false;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('redstreet_users') || '{}');
            if (savedUsers[username.toLowerCase()]) {
                errorElement.textContent = '–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
                return false;
            }
            
            errorElement.textContent = '‚úì –î–æ—Å—Ç—É–ø–Ω–æ';
            errorElement.style.color = '#4cd964';
            loginBtn.disabled = false;
            return true;
        }

        // ============ –§–£–ù–ö–¶–ò–Ø –í–•–û–î–ê ============
        function login() {
            const usernameInput = document.getElementById('usernameInput');
            const username = usernameInput.value.trim().toLowerCase();
            
            if (!validateUsername(username)) return;
            
            currentUser = username;
            
            const savedUsers = JSON.parse(localStorage.getItem('redstreet_users') || '{}');
            savedUsers[username] = {
                username: username,
                createdAt: new Date().toISOString()
            };
            localStorage.setItem('redstreet_users', JSON.stringify(savedUsers));
            localStorage.setItem('redstreet_current_user', username);
            
            // –°–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
            currentProfile = {
                username: username,
                displayName: username,
                bio: '',
                status: 'Online',
                avatar: 'default',
                avatarColor: getRandomColor()
            };
            saveProfile();
            
            loadChats();
            loadMessages();
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'block';
            
            updateUserInfo();
            document.getElementById('messageInput').focus();
            
            addSystemMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, @${username}! –ù–∞–ø–∏—à–∏—Ç–µ "—Å—Ç–∞—Ä—Ç" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –≤ –≥–æ—Ä–æ–¥–∞.`);
        }

        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–§–ò–õ–ï–ú ============
        function showProfile() {
            document.getElementById('chatArea').style.display = 'none';
            document.getElementById('profileArea').style.display = 'flex';
            document.querySelector('.nav-btn:nth-child(1)').classList.remove('active');
            document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
            
            updateProfileView();
        }

        function showChat() {
            document.getElementById('profileArea').style.display = 'none';
            document.getElementById('chatArea').style.display = 'flex';
            document.querySelector('.nav-btn:nth-child(2)').classList.remove('active');
            document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
        }

        function updateProfileView() {
            document.getElementById('profileUsername').textContent = `@${currentProfile.username}`;
            document.getElementById('profileDisplayName').value = currentProfile.displayName || currentProfile.username;
            document.getElementById('profileBio').value = currentProfile.bio || '';
            document.getElementById('profileStatus').value = currentProfile.status || 'Online';
            
            const profileAvatar = document.getElementById('profileAvatar');
            if (currentProfile.avatar && currentProfile.avatar !== 'default') {
                profileAvatar.innerHTML = `<img src="${currentProfile.avatar}" alt="${currentProfile.displayName}">`;
            } else {
                profileAvatar.textContent = (currentProfile.displayName || currentProfile.username).charAt(0).toUpperCase();
                profileAvatar.style.background = currentProfile.avatarColor || getRandomColor();
            }
            
            updateUserAvatar();
        }

        function updateProfile(event) {
            event.preventDefault();
            
            currentProfile.displayName = document.getElementById('profileDisplayName').value.trim() || currentProfile.username;
            currentProfile.bio = document.getElementById('profileBio').value.trim();
            currentProfile.status = document.getElementById('profileStatus').value.trim() || 'Online';
            
            saveProfile();
            updateUserInfo();
            
            alert('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
            showChat();
        }

        function saveProfile() {
            localStorage.setItem(`redstreet_profile_${currentUser}`, JSON.stringify(currentProfile));
        }

        function getRandomColor() {
            const colors = [
                'linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%)',
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #20c997 0%, #17a2b8 100%)',
                'linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%)',
                'linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%)'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function openAvatarSelector() {
            const avatarsGrid = document.getElementById('avatarsGrid');
            avatarsGrid.innerHTML = '';
            
            // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏
            const defaultAvatars = [
                { char: currentProfile.username.charAt(0).toUpperCase(), color: getRandomColor(), id: 'default' },
                { char: 'üòä', color: getRandomColor(), id: 'emoji1' },
                { char: 'üòé', color: getRandomColor(), id: 'emoji2' },
                { char: 'ü§ñ', color: getRandomColor(), id: 'emoji3' },
                { char: 'üê±', color: getRandomColor(), id: 'emoji4' },
                { char: 'ü¶ä', color: getRandomColor(), id: 'emoji5' },
                { char: 'üéÆ', color: getRandomColor(), id: 'emoji6' },
                { char: 'üöÄ', color: getRandomColor(), id: 'emoji7' }
            ];
            
            defaultAvatars.forEach(avatar => {
                const avatarElement = document.createElement('div');
                avatarElement.className = `avatar-option ${avatar.id === currentProfile.avatar ? 'selected' : ''}`;
                avatarElement.style.background = avatar.color;
                avatarElement.textContent = avatar.char;
                avatarElement.onclick = () => selectAvatar(avatar.id, avatar.color, avatar.char);
                
                avatarsGrid.appendChild(avatarElement);
            });
            
            document.getElementById('avatarModal').style.display = 'flex';
        }

        function selectAvatar(avatarId, color, char) {
            selectedAvatar = avatarId;
            document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function saveSelectedAvatar() {
            if (selectedAvatar === 'default') {
                currentProfile.avatar = 'default';
                currentProfile.avatarColor = getRandomColor();
            } else {
                currentProfile.avatar = selectedAvatar;
            }
            
            saveProfile();
            updateProfileView();
            closeAvatarSelector();
        }

        function closeAvatarSelector() {
            document.getElementById('avatarModal').style.display = 'none';
        }

        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ú ============
        function updateUserInfo() {
            document.getElementById('currentUsername').textContent = `@${currentProfile.username}`;
            
            const userAvatar = document.getElementById('userAvatar');
            const profileAvatar = document.getElementById('profileAvatar');
            
            if (currentProfile.avatar && currentProfile.avatar !== 'default') {
                userAvatar.innerHTML = `<img src="${currentProfile.avatar}" alt="${currentProfile.displayName}">`;
                profileAvatar.innerHTML = `<img src="${currentProfile.avatar}" alt="${currentProfile.displayName}">`;
            } else {
                const initial = (currentProfile.displayName || currentProfile.username).charAt(0).toUpperCase();
                userAvatar.textContent = initial;
                userAvatar.style.background = currentProfile.avatarColor || getRandomColor();
                profileAvatar.textContent = initial;
                profileAvatar.style.background = currentProfile.avatarColor || getRandomColor();
            }
        }

        function updateUserAvatar() {
            const userAvatar = document.getElementById('userAvatar');
            if (currentProfile.avatar && currentProfile.avatar !== 'default') {
                userAvatar.innerHTML = `<img src="${currentProfile.avatar}" alt="${currentProfile.displayName}">`;
            } else {
                const initial = (currentProfile.displayName || currentProfile.username).charAt(0).toUpperCase();
                userAvatar.textContent = initial;
                userAvatar.style.background = currentProfile.avatarColor || getRandomColor();
            }
        }

        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ß–ê–¢–ê–ú–ò ============
        function loadChats() {
            const savedChats = localStorage.getItem(`redstreet_chats_${currentUser}`);
            if (savedChats) {
                chats = JSON.parse(savedChats);
            }
            updateChatList();
        }

        function saveChats() {
            localStorage.setItem(`redstreet_chats_${currentUser}`, JSON.stringify(chats));
        }

        function addChatToList(chat) {
            const chatsList = document.getElementById('chatsList');
            
            const chatElement = document.createElement('div');
            chatElement.className = `chat-item ${chat.id === currentChat ? 'active' : ''}`;
            chatElement.onclick = () => switchChat(chat.id);
            
            const displayName = chat.type === 'private' 
                ? `@${chat.users.find(u => u !== currentUser)}`
                : chat.name;
            
            let avatarChar = 'G';
            if (chat.type === 'private') avatarChar = 'P';
            if (chat.type === 'bot') avatarChar = 'ü§ñ';
            
            chatElement.innerHTML = `
                <div class="chat-avatar" style="${chat.type === 'bot' ? 'font-size: 24px;' : ''}">
                    ${avatarChar}
                </div>
                <div class="chat-info">
                    <div class="chat-name">${displayName}</div>
                    <div class="chat-last-message">
                        ${chat.type === 'private' ? '–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç' : chat.type === 'bot' ? '–ß–∞—Ç —Å –±–æ—Ç–æ–º' : '–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç'}
                    </div>
                </div>
            `;
            
            chatsList.appendChild(chatElement);
        }

        function updateChatList() {
            const chatsList = document.getElementById('chatsList');
            chatsList.innerHTML = '';
            chats.forEach(chat => addChatToList(chat));
        }

        function switchChat(chatId) {
            currentChat = chatId;
            const chat = chats.find(c => c.id === chatId);
            
            if (chat) {
                document.getElementById('currentChatTitle').innerHTML = `
                    <div class="chat-title-avatar" style="${chat.type === 'bot' ? 'font-size: 24px;' : ''}">
                        ${chat.type === 'private' ? 'P' : chat.type === 'bot' ? 'ü§ñ' : 'G'}
                    </div>
                    <span>${chat.type === 'private' ? `@${chat.users.find(u => u !== currentUser)}` : chat.name}</span>
                `;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∏–≥—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∞—Ç–∞
                const gameBotBtn = document.getElementById('gameBotBtn');
                if (chat.type === 'bot') {
                    gameBotBtn.style.display = 'flex';
                } else {
                    gameBotBtn.style.display = 'none';
                }
            }
            
            document.querySelectorAll('.chat-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.chat-item').forEach(item => {
                if (item.onclick && item.onclick.toString().includes(chatId)) {
                    item.classList.add('active');
                }
            });
            
            loadMessages();
        }

        // ============ –ò–ì–†–ê –í –ì–û–†–û–î–ê ============
        function startGameWithBot() {
            switchChat('bot_games');
            citiesGameActive = true;
            usedCities.clear();
            lastCity = '';
            
            addBotMessage('–ü—Ä–∏–≤–µ—Ç! –Ø –ì–æ—Ä–æ–¥–æ–∫ ü§ñ –î–∞–≤–∞–π —Å—ã–≥—Ä–∞–µ–º –≤ –≥–æ—Ä–æ–¥–∞! –ù–∞–ø–∏—à–∏ "—Å—Ç–∞—Ä—Ç" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.');
        }

        function handleCitiesGame(input) {
            const text = input.toLowerCase().trim();
            
            if (text === '—Å—Ç–∞—Ä—Ç' || text === 'start') {
                citiesGameActive = true;
                usedCities.clear();
                lastCity = '';
                addBotMessage('–û—Ç–ª–∏—á–Ω–æ! –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ù–∞–∑–æ–≤–∏ –ª—é–±–æ–π –≥–æ—Ä–æ–¥ –†–æ—Å—Å–∏–∏. –Ø –ø—Ä–æ–¥–æ–ª–∂—É –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –±—É–∫–≤—É.');
                return true;
            }
            
            if (text === '—Å—Ç–æ–ø' || text === 'stop') {
                citiesGameActive = false;
                addBotMessage('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É. –ù–∞–ø–∏—à–∏ "—Å—Ç–∞—Ä—Ç" —á—Ç–æ–±—ã —Å—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞.');
                return true;
            }
            
            if (!citiesGameActive) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–≤–µ–¥–µ–Ω –≥–æ—Ä–æ–¥
            const city = citiesList.find(c => c.toLowerCase() === text);
            
            if (!city) {
                addBotMessage('–≠—Ç–æ –Ω–µ –≥–æ—Ä–æ–¥ –†–æ—Å—Å–∏–∏ –∏–ª–∏ —è –µ–≥–æ –Ω–µ –∑–Ω–∞—é. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥.');
                return true;
            }
            
            if (usedCities.has(city.toLowerCase())) {
                addBotMessage('–≠—Ç–æ—Ç –≥–æ—Ä–æ–¥ —É–∂–µ –±—ã–ª –Ω–∞–∑–≤–∞–Ω! –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π.');
                return true;
            }
            
            if (lastCity) {
                const lastLetter = lastCity.slice(-1).toLowerCase();
                const firstLetter = city.charAt(0).toLowerCase();
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–æ–±—ã—Ö –±—É–∫–≤
                const specialLetters = ['—å', '—ä', '—ã', '–π'];
                let adjustedLastLetter = lastLetter;
                
                if (specialLetters.includes(lastLetter)) {
                    adjustedLastLetter = lastCity.slice(-2, -1).toLowerCase();
                }
                
                if (adjustedLastLetter !== firstLetter) {
                    addBotMessage(`–ù—É–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –≥–æ—Ä–æ–¥ –Ω–∞ –±—É–∫–≤—É "${adjustedLastLetter.toUpperCase()}". –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ!`);
                    return true;
                }
            }
            
            // –ì–æ—Ä–æ–¥ –ø–æ–¥—Ö–æ–¥–∏—Ç
            usedCities.add(city.toLowerCase());
            lastCity = city;
            
            // –ë–æ—Ç –∏—â–µ—Ç –æ—Ç–≤–µ—Ç
            const botCity = findBotCity(city);
            
            if (botCity) {
                usedCities.add(botCity.toLowerCase());
                lastCity = botCity;
                addBotMessage(`–û—Ç–ª–∏—á–Ω–æ! –ú–æ–π –≥–æ—Ä–æ–¥: ${botCity}. –¢–µ–±–µ –Ω–∞ –±—É–∫–≤—É "${getLastLetter(botCity)}"`);
            } else {
                addBotMessage('–¢—ã –≤—ã–∏–≥—Ä–∞–ª! –Ø –Ω–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ—Ä–æ–¥. –ù–∞–ø–∏—à–∏ "—Å—Ç–∞—Ä—Ç" –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã.');
                citiesGameActive = false;
            }
            
            return true;
        }

        function findBotCity(lastHumanCity) {
            const lastLetter = getLastLetter(lastHumanCity);
            
            // –ò—â–µ–º –≥–æ—Ä–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –±—É–∫–≤—É –∏ –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
            const availableCities = citiesList.filter(city => {
                const cityLower = city.toLowerCase();
                return cityLower.charAt(0) === lastLetter && 
                       !usedCities.has(cityLower) &&
                       cityLower !== lastHumanCity.toLowerCase();
            });
            
            if (availableCities.length > 0) {
                return availableCities[Math.floor(Math.random() * availableCities.length)];
            }
            
            return null;
        }

        function getLastLetter(city) {
            const cityLower = city.toLowerCase();
            const lastChar = cityLower.slice(-1);
            const specialLetters = ['—å', '—ä', '—ã', '–π'];
            
            if (specialLetters.includes(lastChar)) {
                return cityLower.slice(-2, -1);
            }
            
            return lastChar;
        }

        function addBotMessage(text) {
            const message = {
                user: '–ì–æ—Ä–æ–¥–æ–∫',
                text: text,
                time: new Date().toLocaleTimeString(),
                type: 'bot'
            };
            
            messages.push(message);
            saveMessages();
            displayMessages();
        }

        function showCitiesHelp() {
            addSystemMessage('üéÆ **–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –≤ –≥–æ—Ä–æ–¥–∞:**\n1. –ù–∞–ø–∏—à–∏ "—Å—Ç–∞—Ä—Ç" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å\n2. –ù–∞–∑—ã–≤–∞–π –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏\n3. –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π –≥–æ—Ä–æ–¥ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –±—É–∫–≤—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ\n4. –ù–µ–ª—å–∑—è –ø–æ–≤—Ç–æ—Ä—è—Ç—å –≥–æ—Ä–æ–¥–∞\n5. –ß—Ç–æ–±—ã –∑–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É, –Ω–∞–ø–∏—à–∏ "—Å—Ç–æ–ø"\n\n–ë–æ—Ç "–ì–æ—Ä–æ–¥–æ–∫" –±—É–¥–µ—Ç –∏–≥—Ä–∞—Ç—å —Å —Ç–æ–±–æ–π!');
        }

        // ============ –ì–û–õ–û–°–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø ============
        async function toggleVoiceRecording() {
            const recordBtn = document.getElementById('voiceRecordBtn');
            
            if (!isRecording) {
                // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    voiceRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    voiceRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    
                    voiceRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        sendVoiceMessage(audioBlob);
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    voiceRecorder.start();
                    isRecording = true;
                    recordBtn.classList.add('recording');
                    recordBtn.innerHTML = '‚èπÔ∏è';
                    recordBtn.title = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
                    
                } catch (error) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
                    console.error('Microphone error:', error);
                }
            } else {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–ø–∏—Å—å
                if (voiceRecorder && voiceRecorder.state !== 'inactive') {
                    voiceRecorder.stop();
                    isRecording = false;
                    recordBtn.classList.remove('recording');
                    recordBtn.innerHTML = 'üé§';
                    recordBtn.title = '–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ';
                }
            }
        }

        function sendVoiceMessage(audioBlob) {
            const audioUrl = URL.createObjectURL(audioBlob);
            const duration = 15; // –§–∏–∫—Ç–∏–≤–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª—è—Ç—å
            
            const message = {
                user: currentUser,
                text: '[–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ]',
                time: new Date().toLocaleTimeString(),
                type: 'voice',
                audioUrl: audioUrl,
                duration: duration,
                isMy: true
            };
            
            messages.push(message);
            saveMessages();
            displayMessages();
        }

        function playVoiceMessage(audioUrl, progressBar, playBtn) {
            if (currentAudio) {
                currentAudio.pause();
                document.querySelectorAll('.voice-play-btn').forEach(btn => {
                    btn.classList.remove('playing');
                    btn.innerHTML = '‚ñ∂';
                });
            }
            
            currentAudio = new Audio(audioUrl);
            currentAudio.play();
            
            playBtn.classList.add('playing');
            playBtn.innerHTML = '‚è∏';
            
            currentAudio.ontimeupdate = () => {
                const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
                progressBar.style.width = progress + '%';
            };
            
            currentAudio.onended = () => {
                playBtn.classList.remove('playing');
                playBtn.innerHTML = '‚ñ∂';
                progressBar.style.width = '0%';
                currentAudio = null;
            };
        }

        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø–ú–ò ============
        function loadMessages() {
            const savedMessages = localStorage.getItem(`redstreet_messages_${currentChat}`);
            messages = savedMessages ? JSON.parse(savedMessages) : [];
            displayMessages();
        }

        function saveMessages() {
            localStorage.setItem(`redstreet_messages_${currentChat}`, JSON.stringify(messages));
        }

        function addSystemMessage(text) {
            const message = {
                user: '–°–∏—Å—Ç–µ–º–∞',
                text: text,
                time: new Date().toLocaleTimeString(),
                type: 'system'
            };
            messages.push(message);
            saveMessages();
            displayMessages();
        }

        function displayMessages() {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.user === currentUser ? 'my' : msg.type === 'bot' ? 'bot' : msg.type === 'system' ? 'system' : ''}`;
                
                let messageHTML = '';
                
                if (msg.type === 'voice') {
                    messageHTML = `
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-avatar">
                                    ${msg.user === currentUser ? '–Ø' : msg.user.charAt(0)}
                                </div>
                                <span class="message-username">
                                    ${msg.user === currentUser ? '–í—ã' : '@' + msg.user}
                                </span>
                                <span class="message-time">${msg.time}</span>
                            </div>
                            <div class="voice-message">
                                <button class="voice-play-btn" onclick="playVoiceMessage('${msg.audioUrl}', this.nextElementSibling?.firstChild, this)">
                                    ‚ñ∂
                                </button>
                                <div class="voice-progress">
                                    <div class="voice-progress-bar"></div>
                                </div>
                                <div class="voice-duration">${msg.duration}s</div>
                            </div>
                        </div>
                    `;
                } else {
                    messageHTML = `
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-avatar">
                                    ${msg.user === currentUser ? '–Ø' : msg.type === 'bot' ? 'ü§ñ' : msg.type === 'system' ? '‚öôÔ∏è' : msg.user.charAt(0)}
                                </div>
                                <span class="message-username">
                                    ${msg.type === 'bot' ? '–ì–æ—Ä–æ–¥–æ–∫' : msg.type === 'system' ? '–°–∏—Å—Ç–µ–º–∞' : msg.user === currentUser ? '–í—ã' : '@' + msg.user}
                                </span>
                                <span class="message-time">${msg.time}</span>
                            </div>
                            <div class="message-text">${msg.text.replace(/\n/g, '<br>')}</div>
                        </div>
                    `;
                }
                
                messageDiv.innerHTML = messageHTML;
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ============ –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø ============
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentUser) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–≥—Ä–∞ –ª–∏ —ç—Ç–æ –≤ –≥–æ—Ä–æ–¥–∞
            if (handleCitiesGame(text)) {
                input.value = '';
                input.style.height = '60px';
                input.focus();
                return;
            }
            
            const message = {
                user: currentUser,
                text: text,
                time: new Date().toLocaleTimeString(),
                isMy: true
            };
            
            messages.push(message);
            saveMessages();
            displayMessages();
            
            input.value = '';
            input.style.height = '60px';
            input.focus();
        }

        // ============ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============
        function autoResize(textarea) {
            textarea.style.height = '60px';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        }

        function handleMessageKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                searchUser();
            }
        }

        function searchUser() {
            const searchInput = document.getElementById('searchUserInput');
            const username = searchInput.value.trim().toLowerCase().replace('@', '');
            const foundUsersElement = document.getElementById('foundUsers');
            
            foundUsersElement.innerHTML = '';
            
            if (!username) return;
            
            const savedUsers = JSON.parse(localStorage.getItem('redstreet_users') || '{}');
            const matches = [];
            
            for (const userKey in savedUsers) {
                if (userKey.includes(username) && userKey !== currentUser) {
                    matches.push(savedUsers[userKey]);
                }
            }
            
            if (matches.length === 0) {
                foundUsersElement.innerHTML = `
                    <div class="found-user" style="color: #a0a0c0; justify-content: center;">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
                    </div>
                `;
                return;
            }
            
            matches.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'found-user';
                userElement.onclick = () => startChatWithUser(user.username);
                userElement.innerHTML = `
                    <div class="chat-avatar">${user.username.charAt(0).toUpperCase()}</div>
                    <div>
                        <div style="font-weight: 600;">@${user.username}</div>
                        <div style="font-size: 12px; color: #a0a0c0;">
                            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(user.createdAt).toLocaleDateString()}
                        </div>
                    </div>
                `;
                foundUsersElement.appendChild(userElement);
            });
        }

        function startChatWithUser(username) {
            const chatId = `private_${[currentUser, username].sort().join('_')}`;
            let chat = chats.find(c => c.id === chatId);
            
            if (!chat) {
                chat = {
                    id: chatId,
                    name: `@${username}`,
                    type: 'private',
                    users: [currentUser, username]
                };
                chats.push(chat);
                saveChats();
                addChatToList(chat);
                addSystemMessage(`–í—ã –Ω–∞—á–∞–ª–∏ —á–∞—Ç —Å @${username}`);
            }
            
            switchChat(chatId);
            document.getElementById('searchUserInput').value = '';
            document.getElementById('foundUsers').innerHTML = '';
        }

        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }
                
                if (isRecording && voiceRecorder) {
                    voiceRecorder.stop();
                }
                
                localStorage.removeItem('redstreet_current_user');
                currentUser = '';
                
                document.getElementById('chatScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('usernameInput').value = '';
                document.getElementById('usernameInput').focus();
            }
        }

        // ============ –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============
        function attachFile() {
            document.getElementById('fileInput').click();
        }

        function showEmojiPicker() {
            const emojis = ['üòÄ', 'üòÇ', 'ü•∞', 'üòé', 'ü§î', 'üëç', '‚ù§Ô∏è', 'üî•', 'üéÆ', 'üöÄ'];
            const input = document.getElementById('messageInput');
            const selectedEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            input.value += selectedEmoji;
            autoResize(input);
        }

        function showAddUserModal() {
            if (currentChat === 'general') {
                alert('–í –æ–±—â–∏–π —á–∞—Ç –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫');
                return;
            }
            
            document.getElementById('addUserModal').style.display = 'flex';
            document.getElementById('addUserInput').focus();
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
            document.getElementById('addUserInput').value = '';
            document.getElementById('addUserError').textContent = '';
        }

        function addUserToChat() {
            const usernameInput = document.getElementById('addUserInput');
            const username = usernameInput.value.trim().toLowerCase().replace('@', '');
            const errorElement = document.getElementById('addUserError');
            
            if (!username) {
                errorElement.textContent = '–í–≤–µ–¥–∏—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º';
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('redstreet_users') || '{}');
            if (!savedUsers[username]) {
                errorElement.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                return;
            }
            
            if (username === currentUser) {
                errorElement.textContent = '–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è';
                return;
            }
            
            const chat = chats.find(c => c.id === currentChat);
            if (!chat) return;
            
            if (chat.users.includes(username)) {
                errorElement.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ —á–∞—Ç–µ';
                return;
            }
            
            chat.users.push(username);
            chat.name = `–ì—Ä—É–ø–ø–∞ (${chat.users.length})`;
            saveChats();
            updateChatList();
            addSystemMessage(`@${username} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç`);
            hideAddUserModal();
        }
    </script>
</body>
</html>